angular.module("afkl.lazyImage",[]),angular.module("afkl.lazyImage").service("afklSrcSetService",[function(){"use strict";function a(a,b){var c,d;return function(){var e=+new Date;c&&e<c+b?(clearTimeout(d),d=setTimeout(function(){c=e,a()},b+c-e)):(c=e,a())}}return{throttle:a}}]),angular.module("afkl.lazyImage").directive("afklImageContainer",function(){"use strict";return{restrict:"A",controller:["$scope","$element",function(a,b){b.data("afklImageContainer",b)}]}}).directive("afklLazyImage",["$rootScope","$window","$timeout","afklSrcSetService","$parse",function(a,b,c,d,e){"use strict";return{restrict:"A",link:function(a,f,g){var h=function(a){var b=[],c="afkl-lazy-image",d=!1;return m.imgAttrs&&(b=Array.prototype.map.call(a,function(a){for(var b in a)if(a.hasOwnProperty(b)){var e=a[b];return"class"===b&&(d=!0,e=e+" "+c),String.prototype.concat.call(b,'="',e,'"')}})),d||b.push('class="'+c+'"'),b.join(" ")},i=f.inheritedData("afklImageContainer");i||(i=angular.element(g.afklLazyImageContainer||b));var j,k=!1,l=g.afklLazyImage,m=g.afklLazyImageOptions?e(g.afklLazyImageOptions)(a):{},n=null,o=null,p=m.offset?m.offset:50,q=h(m.imgAttrs),r="afkl-lazy-image-loading";g.afklLazyImageLoaded=!1;var s=function(){if(i.scrollTop){var a=i.scrollTop();if(a)return a}var b=i[0];return void 0!==b.pageYOffset?b.pageYOffset:void 0!==b.scrollTop?b.scrollTop:document.documentElement.scrollTop||0},t=function(){if(i.innerHeight)return i.innerHeight();var a=i[0];return void 0!==a.innerHeight?a.innerHeight:void 0!==a.clientHeight?a.clientHeight:document.documentElement.clientHeight||0},u=function(){if(f.offset)return f.offset().top;var a=f[0].getBoundingClientRect();return a.top+s()-document.documentElement.clientTop},v=function(){return f.offset?f.offset().top-i.offset().top:f[0].getBoundingClientRect().top-i[0].getBoundingClientRect().top},w=function(){m.background?f[0].style.backgroundImage='url("'+o+'")':n&&(n[0].src=o)},x=function(){k=!0;var a=l;a&&(m.background||n||(f.addClass(r),n=angular.element("<img "+q+" />"),n.one("load",z),n.one("error",A),f.append(n)),y()),i.off("scroll",B)},y=function(){if(k){var a=l;a!==o&&(o=a,w())}};y();var z=function(){g.$set("afklLazyImageLoaded","done"),f.removeClass(r),D()},A=function(){g.$set("afklLazyImageLoaded","fail")},B=function(){if(!k){var a,c,d,e=t(),f=s(),g=i[0]===b?u():v();d=i[0]===b?e+f:e,a=g-d,c=a<=p,c&&x()}},C=d.throttle(B,800),D=function(){c.cancel(j),i[0]!==b&&i.off("scroll",C),j=void 0},E=function(){c.cancel(j),i[0]!==b&&i.off("scroll",C),n&&n.remove(),n=j=o=void 0};return i[0]!==b&&i.on("scroll",C),g.$observe("afklLazyImage",function(){l=g.afklLazyImage,k&&x()}),m.nolazy&&x(),a.$on("$destroy",function(){return E()}),B()}}}]);